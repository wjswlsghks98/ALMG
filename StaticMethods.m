classdef StaticMethods < handle
    %STATICMETHODS is a module for computing residual and jacobians for
    % single/multiple arc approximation.
    % This class module is initiated at the start of single/multiple arc
    % spline approximation modules.
    properties
        
    end

    methods
        %% Constructor
        function obj = StaticMethods()
            
        end

        %% Anchor Residual
        function res = getACRes(obj,pt,arcNode)
            res = arcNode - pt;
        end
        
        %% Measurement Residual, Jacobian
        function [res,jac] = getMEResJac(obj,A1,A2,k,P)
            hsq = 1/2 * norm(A1 - A2);
            v = 1/(2*hsq)*[0,-1;1,0] * (A2 - A1);
            C1 = 1/2 * (A1 + A2) + k * v;
            Xc = 1/2 * (A1 + A2) - hsq^2/k * v;
            R = norm(Xc - A1);
            res = Xc + (R/norm(Xc-P)) * (P - Xc) - P;
            jac = obj.getMEJac(A1,A2,k,P);
        end
        
        %% Measurement Jacobian
        function jac = getMEJac(obj,A1,A2,k,P)
            a1x = A1(1); a1y = A1(2); a2x = A2(1); a2y = A2(2);
            px = P(1); py = P(2);
            jac = zeros(2,5); % A1, A2, k order
            jac(1,1) = ((2*(((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1x - 2*a2x))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) - ((a1y - a2y)*(a1x/2 - a2x/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + 1/2)*(a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))) + 2*(((a1x - a2x)^2/4 + (a1y - a2y)^2/4)/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + ((a1x - a2x)*(a1x/2 - a2x/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1x - 2*a2x))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)))*(a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))*((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*(a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(2*((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(3/2)) - ((a1y - a2y)*(a1x/2 - a2x/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - (((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*(((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1x - 2*a2x))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) - ((a1y - a2y)*(a1x/2 - a2x/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + 1/2))/((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2) - ((2*(((a1x - a2x)^2/4 + (a1y - a2y)^2/4)/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + ((a1x - a2x)*(a1x/2 - a2x/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1x - 2*a2x))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)))*(a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))) + 2*(((a1y - a2y)*(a1x/2 - a2x/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1x - 2*a2x))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) + 1/2)*(a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))*(a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(2*((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)) + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1x - 2*a2x))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) + 1/2;
            jac(1,2) = (((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*(((a1x - a2x)^2/4 + (a1y - a2y)^2/4)/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + ((a1y - a2y)*(a1y/2 - a2y/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1y - 2*a2y))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2))))/((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2) - ((a1x - a2x)^2/4 + (a1y - a2y)^2/4)/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1y - a2y)*(a1y/2 - a2y/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + ((2*(((a1x - a2x)*(a1y/2 - a2y/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1y - 2*a2y))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) + 1/2)*(a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))) - 2*(((a1x - a2x)^2/4 + (a1y - a2y)^2/4)/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + ((a1y - a2y)*(a1y/2 - a2y/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1y - 2*a2y))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)))*(a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))*((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*(a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(2*((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(3/2)) - ((2*(((a1x - a2x)^2/4 + (a1y - a2y)^2/4)/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + ((a1y - a2y)*(a1y/2 - a2y/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1y - 2*a2y))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)))*(a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))) - 2*(((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1y - 2*a2y))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) - ((a1x - a2x)*(a1y/2 - a2y/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + 1/2)*(a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))*(a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(2*((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)) + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1y - 2*a2y))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2));
            jac(1,3) = ((a1y - a2y)*(a1x/2 - a2x/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - (((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*(((a1y - a2y)*(a1x/2 - a2x/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1x - 2*a2x))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) + 1/2))/((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2) + ((2*(((a1y - a2y)*(a1x/2 - a2x/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1x - 2*a2x))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) + 1/2)*(a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))) - 2*(((a1x - a2x)^2/4 + (a1y - a2y)^2/4)/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + ((a1x - a2x)*(a1x/2 - a2x/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1x - 2*a2x))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)))*(a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))*((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*(a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(2*((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(3/2)) + ((2*(((a1x - a2x)^2/4 + (a1y - a2y)^2/4)/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + ((a1x - a2x)*(a1x/2 - a2x/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1x - 2*a2x))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)))*(a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))) + 2*(((a1y - a2y)*(a1x/2 - a2x/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1x - 2*a2x))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) + 1/2)*(a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))*(a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(2*((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)) - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1x - 2*a2x))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) + 1/2;
            jac(1,4) = ((a1x - a2x)^2/4 + (a1y - a2y)^2/4)/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - (((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*(((a1x - a2x)^2/4 + (a1y - a2y)^2/4)/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + ((a1y - a2y)*(a1y/2 - a2y/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1y - 2*a2y))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2))))/((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2) + ((a1y - a2y)*(a1y/2 - a2y/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + ((2*(((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1y - 2*a2y))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) - ((a1x - a2x)*(a1y/2 - a2y/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + 1/2)*(a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))) + 2*(((a1x - a2x)^2/4 + (a1y - a2y)^2/4)/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + ((a1y - a2y)*(a1y/2 - a2y/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1y - 2*a2y))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)))*(a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))*((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*(a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(2*((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(3/2)) + ((2*(((a1x - a2x)^2/4 + (a1y - a2y)^2/4)/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + ((a1y - a2y)*(a1y/2 - a2y/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1y - 2*a2y))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)))*(a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))) - 2*(((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1y - 2*a2y))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) - ((a1x - a2x)*(a1y/2 - a2y/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + 1/2)*(a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))*(a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(2*((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)) - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1y - 2*a2y))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2));
            jac(1,5) = ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k^2*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + (((2*(a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(k^2*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - (2*(a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(k^2*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))*((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*(a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(2*((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(3/2)) + (((2*(a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(k^2*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + (2*(a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(k^2*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))*(a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(2*((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)) - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2))/(k^2*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2));
            
            jac(2,1) = ((a1x - a2x)^2/4 + (a1y - a2y)^2/4)/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - (((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*(((a1x - a2x)^2/4 + (a1y - a2y)^2/4)/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + ((a1x - a2x)*(a1x/2 - a2x/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1x - 2*a2x))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2))))/((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2) + ((a1x - a2x)*(a1x/2 - a2x/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + ((2*(((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1x - 2*a2x))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) - ((a1y - a2y)*(a1x/2 - a2x/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + 1/2)*(a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))) + 2*(((a1x - a2x)^2/4 + (a1y - a2y)^2/4)/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + ((a1x - a2x)*(a1x/2 - a2x/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1x - 2*a2x))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)))*(a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))*((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*(a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(2*((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(3/2)) - ((2*(((a1x - a2x)^2/4 + (a1y - a2y)^2/4)/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + ((a1x - a2x)*(a1x/2 - a2x/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1x - 2*a2x))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)))*(a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))) + 2*(((a1y - a2y)*(a1x/2 - a2x/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1x - 2*a2x))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) + 1/2)*(a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))*(a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(2*((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)) - ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1x - 2*a2x))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2));
            jac(2,2) = ((a1x - a2x)*(a1y/2 - a2y/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - (((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*(((a1x - a2x)*(a1y/2 - a2y/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1y - 2*a2y))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) + 1/2))/((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2) + ((2*(((a1x - a2x)*(a1y/2 - a2y/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1y - 2*a2y))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) + 1/2)*(a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))) - 2*(((a1x - a2x)^2/4 + (a1y - a2y)^2/4)/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + ((a1y - a2y)*(a1y/2 - a2y/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1y - 2*a2y))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)))*(a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))*((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*(a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(2*((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(3/2)) - ((2*(((a1x - a2x)^2/4 + (a1y - a2y)^2/4)/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + ((a1y - a2y)*(a1y/2 - a2y/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1y - 2*a2y))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)))*(a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))) - 2*(((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1y - 2*a2y))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) - ((a1x - a2x)*(a1y/2 - a2y/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + 1/2)*(a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))*(a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(2*((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)) - ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1y - 2*a2y))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) + 1/2;
            jac(2,3) = (((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*(((a1x - a2x)^2/4 + (a1y - a2y)^2/4)/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + ((a1x - a2x)*(a1x/2 - a2x/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1x - 2*a2x))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2))))/((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2) - ((a1x - a2x)^2/4 + (a1y - a2y)^2/4)/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1x - a2x)*(a1x/2 - a2x/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + ((2*(((a1y - a2y)*(a1x/2 - a2x/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1x - 2*a2x))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) + 1/2)*(a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))) - 2*(((a1x - a2x)^2/4 + (a1y - a2y)^2/4)/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + ((a1x - a2x)*(a1x/2 - a2x/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1x - 2*a2x))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)))*(a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))*((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*(a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(2*((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(3/2)) + ((2*(((a1x - a2x)^2/4 + (a1y - a2y)^2/4)/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + ((a1x - a2x)*(a1x/2 - a2x/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1x - 2*a2x))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)))*(a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))) + 2*(((a1y - a2y)*(a1x/2 - a2x/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1x - 2*a2x))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) + 1/2)*(a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))*(a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(2*((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)) + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1x - 2*a2x))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2));
            jac(2,4) = ((2*(((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1y - 2*a2y))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) - ((a1x - a2x)*(a1y/2 - a2y/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + 1/2)*(a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))) + 2*(((a1x - a2x)^2/4 + (a1y - a2y)^2/4)/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + ((a1y - a2y)*(a1y/2 - a2y/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1y - 2*a2y))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)))*(a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))*((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*(a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(2*((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(3/2)) - ((a1x - a2x)*(a1y/2 - a2y/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - (((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*(((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1y - 2*a2y))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) - ((a1x - a2x)*(a1y/2 - a2y/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + 1/2))/((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2) + ((2*(((a1x - a2x)^2/4 + (a1y - a2y)^2/4)/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + ((a1y - a2y)*(a1y/2 - a2y/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1y - 2*a2y))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)))*(a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))) - 2*(((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1y - 2*a2y))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) - ((a1x - a2x)*(a1y/2 - a2y/2))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + 1/2)*(a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))*(a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(2*((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)) + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(2*a1y - 2*a2y))/(2*k*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) + 1/2;
            jac(2,5) = (((2*(a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(k^2*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) - (2*(a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(k^2*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))*((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*(a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(2*((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(3/2)) - ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k^2*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + (((2*(a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(k^2*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + (2*(a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*(a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(k^2*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))*(a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))))/(2*((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)*((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2)) + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4)*((a1x/2 - a2x/2 + ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a2y/2 - a1y/2 + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2))/(k^2*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*((a1x/2 + a2x/2 - px - ((a1y - a2y)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2 + (a1y/2 + a2y/2 - py + ((a1x - a2x)*((a1x - a2x)^2/4 + (a1y - a2y)^2/4))/(k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))^2)^(1/2));            
        end
        
        %% Constraint Block 1 residual
        function res = getCS1Res(obj,A1,A2,A3,k1,k2)
            hsq1 = 1/2 * norm(A1 - A2);
            hsq2 = 1/2 * norm(A2 - A3);
            v1 = 1/(2*hsq1)*[0,-1;1,0] * (A2 - A1);
            v2 = 1/(2*hsq2)*[0,-1;1,0] * (A3 - A2);
            C1 = 1/2 * (A1 + A2) + k1 * v1;
            C2 = 1/2 * (A2 + A3) + k2 * v2;
            L1 = sqrt(hsq1^2 + k1^2);
            L2 = sqrt(hsq2^2 + k2^2);
            res = (L1 * C2 + L2 * C1)/(L1+L2) - A2;
        end

        %% Constraint Block 1 jacobian
        function jac = getCS1Jac(obj,A1,A2,A3,k1,k2)
            a1x = A1(1); a1y = A1(2); a2x = A2(1); a2y = A2(2); a3x = A3(1); a3y = A3(2);
            jac_aN = zeros(2,6);
            jac_aN(1,1) = - (((k1*(a1y - a2y)*(2*a1x - 2*a2x))/(2*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) - 1/2)*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2) - ((a1x/2 - a2x/2)*(a2x/2 + a3x/2 + (k2*(a2y - a3y))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2)))/(2*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)) - (((k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)*(a1x/2 + a2x/2 + (k1*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + (k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)*(a2x/2 + a3x/2 + (k2*(a2y - a3y))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2)))*(a1x/2 - a2x/2))/(2*((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2))^2*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2));
            jac_aN(1,2) = ((k1/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2) - (k1*(a1y - a2y)*(2*a1y - 2*a2y))/(2*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)))*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2) + ((a1y/2 - a2y/2)*(a2x/2 + a3x/2 + (k2*(a2y - a3y))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2)))/(2*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)) - (((k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)*(a1x/2 + a2x/2 + (k1*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + (k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)*(a2x/2 + a3x/2 + (k2*(a2y - a3y))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2)))*(a1y/2 - a2y/2))/(2*((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2))^2*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2));
            jac_aN(1,3) = (((k1*(a1y - a2y)*(2*a1x - 2*a2x))/(2*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) + 1/2)*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2) - ((k2*(a2y - a3y)*(2*a2x - 2*a3x))/(2*((a2x - a3x)^2 + (a2y - a3y)^2)^(3/2)) - 1/2)*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + ((a2x/2 - a3x/2)*(a1x/2 + a2x/2 + (k1*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)) - ((a1x/2 - a2x/2)*(a2x/2 + a3x/2 + (k2*(a2y - a3y))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2)))/(2*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)) + (((k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)*(a1x/2 + a2x/2 + (k1*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + (k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)*(a2x/2 + a3x/2 + (k2*(a2y - a3y))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2)))*((a1x/2 - a2x/2)/(2*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (a2x/2 - a3x/2)/(2*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2))))/((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2))^2 - 1;
            jac_aN(1,4) = (((k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)*(a1x/2 + a2x/2 + (k1*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + (k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)*(a2x/2 + a3x/2 + (k2*(a2y - a3y))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2)))*((a1y/2 - a2y/2)/(2*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (a2y/2 - a3y/2)/(2*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2))))/((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2))^2 - ((k1/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2) - (k1*(a1y - a2y)*(2*a1y - 2*a2y))/(2*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)))*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2) - (k2/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2) - (k2*(a2y - a3y)*(2*a2y - 2*a3y))/(2*((a2x - a3x)^2 + (a2y - a3y)^2)^(3/2)))*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) - ((a2y/2 - a3y/2)*(a1x/2 + a2x/2 + (k1*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)) + ((a1y/2 - a2y/2)*(a2x/2 + a3x/2 + (k2*(a2y - a3y))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2)))/(2*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2));
            jac_aN(1,5) = (((k2*(a2y - a3y)*(2*a2x - 2*a3x))/(2*((a2x - a3x)^2 + (a2y - a3y)^2)^(3/2)) + 1/2)*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) - ((a2x/2 - a3x/2)*(a1x/2 + a2x/2 + (k1*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)))/((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)) + (((k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)*(a1x/2 + a2x/2 + (k1*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + (k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)*(a2x/2 + a3x/2 + (k2*(a2y - a3y))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2)))*(a2x/2 - a3x/2))/(2*((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2))^2*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2));
            jac_aN(1,6) = (((k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)*(a1x/2 + a2x/2 + (k1*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + (k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)*(a2x/2 + a3x/2 + (k2*(a2y - a3y))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2)))*(a2y/2 - a3y/2))/(2*((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2))^2*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)) - ((k2/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2) - (k2*(a2y - a3y)*(2*a2y - 2*a3y))/(2*((a2x - a3x)^2 + (a2y - a3y)^2)^(3/2)))*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + ((a2y/2 - a3y/2)*(a1x/2 + a2x/2 + (k1*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)))/((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2));
            
            jac_aN(2,1) = - ((k1/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2) - (k1*(a1x - a2x)*(2*a1x - 2*a2x))/(2*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)))*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2) - ((a1x/2 - a2x/2)*(a2y/2 + a3y/2 - (k2*(a2x - a3x))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2)))/(2*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)) - (((k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)*(a1y/2 + a2y/2 - (k1*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + (k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)*(a2y/2 + a3y/2 - (k2*(a2x - a3x))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2)))*(a1x/2 - a2x/2))/(2*((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2))^2*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2));
            jac_aN(2,2) = (((k1*(a1x - a2x)*(2*a1y - 2*a2y))/(2*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) + 1/2)*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2) + ((a1y/2 - a2y/2)*(a2y/2 + a3y/2 - (k2*(a2x - a3x))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2)))/(2*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)) - (((k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)*(a1y/2 + a2y/2 - (k1*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + (k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)*(a2y/2 + a3y/2 - (k2*(a2x - a3x))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2)))*(a1y/2 - a2y/2))/(2*((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2))^2*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2));
            jac_aN(2,3) = ((k1/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2) - (k1*(a1x - a2x)*(2*a1x - 2*a2x))/(2*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)))*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2) - (k2/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2) - (k2*(a2x - a3x)*(2*a2x - 2*a3x))/(2*((a2x - a3x)^2 + (a2y - a3y)^2)^(3/2)))*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + ((a2x/2 - a3x/2)*(a1y/2 + a2y/2 - (k1*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)) - ((a1x/2 - a2x/2)*(a2y/2 + a3y/2 - (k2*(a2x - a3x))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2)))/(2*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)) + (((k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)*(a1y/2 + a2y/2 - (k1*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + (k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)*(a2y/2 + a3y/2 - (k2*(a2x - a3x))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2)))*((a1x/2 - a2x/2)/(2*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (a2x/2 - a3x/2)/(2*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2))))/((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2))^2;
            jac_aN(2,4) = (((k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)*(a1y/2 + a2y/2 - (k1*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + (k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)*(a2y/2 + a3y/2 - (k2*(a2x - a3x))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2)))*((a1y/2 - a2y/2)/(2*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (a2y/2 - a3y/2)/(2*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2))))/((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2))^2 - (((k1*(a1x - a2x)*(2*a1y - 2*a2y))/(2*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) - 1/2)*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2) - ((k2*(a2x - a3x)*(2*a2y - 2*a3y))/(2*((a2x - a3x)^2 + (a2y - a3y)^2)^(3/2)) + 1/2)*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) - ((a2y/2 - a3y/2)*(a1y/2 + a2y/2 - (k1*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)) + ((a1y/2 - a2y/2)*(a2y/2 + a3y/2 - (k2*(a2x - a3x))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2)))/(2*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)) - 1;
            jac_aN(2,5) = ((k2/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2) - (k2*(a2x - a3x)*(2*a2x - 2*a3x))/(2*((a2x - a3x)^2 + (a2y - a3y)^2)^(3/2)))*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) - ((a2x/2 - a3x/2)*(a1y/2 + a2y/2 - (k1*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)))/((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)) + (((k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)*(a1y/2 + a2y/2 - (k1*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + (k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)*(a2y/2 + a3y/2 - (k2*(a2x - a3x))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2)))*(a2x/2 - a3x/2))/(2*((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2))^2*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2));
            jac_aN(2,6) = (((k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)*(a1y/2 + a2y/2 - (k1*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + (k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)*(a2y/2 + a3y/2 - (k2*(a2x - a3x))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2)))*(a2y/2 - a3y/2))/(2*((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2))^2*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)) - (((k2*(a2x - a3x)*(2*a2y - 2*a3y))/(2*((a2x - a3x)^2 + (a2y - a3y)^2)^(3/2)) - 1/2)*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + ((a2y/2 - a3y/2)*(a1y/2 + a2y/2 - (k1*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)))/((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2));

            jac_k = zeros(2,2);
            jac_k(1,1) = (((a1y - a2y)*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2) + (k1*(a2x/2 + a3x/2 + (k2*(a2y - a3y))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2)))/(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2))/((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)) - (k1*((k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)*(a1x/2 + a2x/2 + (k1*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + (k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)*(a2x/2 + a3x/2 + (k2*(a2y - a3y))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2))))/(((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2))^2*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2));
            jac_k(1,2) = (((a2y - a3y)*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2) + (k2*(a1x/2 + a2x/2 + (k1*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2))/((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)) - (k2*((k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)*(a1x/2 + a2x/2 + (k1*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + (k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)*(a2x/2 + a3x/2 + (k2*(a2y - a3y))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2))))/(((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2))^2*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2));
            jac_k(2,1) = - (((a1x - a2x)*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2) - (k1*(a2y/2 + a3y/2 - (k2*(a2x - a3x))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2)))/(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2))/((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)) - (k1*((k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)*(a1y/2 + a2y/2 - (k1*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + (k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)*(a2y/2 + a3y/2 - (k2*(a2x - a3x))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2))))/(((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2))^2*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2));
            jac_k(2,2) = - (((a2x - a3x)*(k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2) - (k2*(a1y/2 + a2y/2 - (k1*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2))/((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)) - (k2*((k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2)*(a1y/2 + a2y/2 - (k1*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)) + (k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)*(a2y/2 + a3y/2 - (k2*(a2x - a3x))/((a2x - a3x)^2 + (a2y - a3y)^2)^(1/2))))/(((k1^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2) + (k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2))^2*(k2^2 + (a2x - a3x)^2/4 + (a2y - a3y)^2/4)^(1/2));

            jac = [jac_aN, jac_k];
        end
        
        %% Constraint Block 2 residual
        function res = getCS2Res(obj,A1,A2,k,L_min)
            hsq = 1/2 * norm(A1 - A2);
            v = 1/(2*hsq)*[0,-1;1,0] * (A2 - A1);
            C1 = 1/2 * (A1 + A2) + k * v;
            w = hsq/sqrt(hsq^2 + k^2);
            N = (1/2 * A1 + w * C1 + 1/2 * A2)/(w+1);
            res = 1 - (norm(A1 - N) + norm(A2 - N))/L_min;
        end
        
        %% Constraint Block2 jacobian
        function jac = getCS2Jac(obj,A1,A2,k,L_min)
            a1x = A1(1); a1y = A1(2); a2x = A2(1); a2y = A2(2);
            jac = zeros(1,5);
            jac(1,1) = -((2*(a1x - (a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))*(((((k*(a1y - a2y)*(2*a1x - 2*a2x))/(2*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) - 1/2)*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - ((2*a1x - 2*a2x)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 - a2x/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)) - 1/2)/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1) + (((2*a1x - 2*a2x)/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 - a2x/2))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))*(a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2))))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)^2 + 1) + 2*(a1y - (a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))*(((((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2) - (k*(a1x - a2x)*(2*a1x - 2*a2x))/(2*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2))))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - ((2*a1x - 2*a2x)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 - a2x/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1) + (((2*a1x - 2*a2x)/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 - a2x/2))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))*(a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2))))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)^2))/(2*((a1x - (a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))^2 + (a1y - (a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))^2)^(1/2)) + (2*(((((k*(a1y - a2y)*(2*a1x - 2*a2x))/(2*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) - 1/2)*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - ((2*a1x - 2*a2x)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 - a2x/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)) - 1/2)/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1) + (((2*a1x - 2*a2x)/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 - a2x/2))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))*(a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2))))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)^2)*(a2x - (a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)) + 2*(a2y - (a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))*(((((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2) - (k*(a1x - a2x)*(2*a1x - 2*a2x))/(2*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2))))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - ((2*a1x - 2*a2x)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 - a2x/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1) + (((2*a1x - 2*a2x)/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 - a2x/2))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))*(a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2))))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)^2))/(2*((a2x - (a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))^2 + (a2y - (a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))^2)^(1/2)))/L_min;
            jac(1,2) = -((2*(a1y - (a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))*((((2*a1y - 2*a2y)/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 - a2y/2))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))*(a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2))))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)^2 - ((((k*(a1x - a2x)*(2*a1y - 2*a2y))/(2*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) + 1/2)*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + ((2*a1y - 2*a2y)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 - a2y/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)) + 1/2)/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1) + 1) - 2*(a1x - (a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))*(((((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2) - (k*(a1y - a2y)*(2*a1y - 2*a2y))/(2*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2))))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + ((2*a1y - 2*a2y)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 - a2y/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1) - (((2*a1y - 2*a2y)/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 - a2y/2))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))*(a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2))))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)^2))/(2*((a1x - (a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))^2 + (a1y - (a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))^2)^(1/2)) - (2*(((((k*(a1x - a2x)*(2*a1y - 2*a2y))/(2*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) + 1/2)*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + ((2*a1y - 2*a2y)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 - a2y/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)) + 1/2)/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1) - (((2*a1y - 2*a2y)/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 - a2y/2))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))*(a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2))))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)^2)*(a2y - (a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)) + 2*(a2x - (a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))*(((((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2) - (k*(a1y - a2y)*(2*a1y - 2*a2y))/(2*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2))))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + ((2*a1y - 2*a2y)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 - a2y/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1) - (((2*a1y - 2*a2y)/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 - a2y/2))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))*(a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2))))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)^2))/(2*((a2x - (a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))^2 + (a2y - (a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))^2)^(1/2)))/L_min;
            jac(1,3) = ((2*(((((k*(a1y - a2y)*(2*a1x - 2*a2x))/(2*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) + 1/2)*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - ((2*a1x - 2*a2x)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 - a2x/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)) + 1/2)/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1) + (((2*a1x - 2*a2x)/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 - a2x/2))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))*(a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2))))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)^2)*(a1x - (a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)) + 2*(a1y - (a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))*(((((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2) - (k*(a1x - a2x)*(2*a1x - 2*a2x))/(2*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2))))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - ((2*a1x - 2*a2x)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 - a2x/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1) + (((2*a1x - 2*a2x)/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 - a2x/2))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))*(a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2))))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)^2))/(2*((a1x - (a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))^2 + (a1y - (a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))^2)^(1/2)) + (2*(a2x - (a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))*(((((k*(a1y - a2y)*(2*a1x - 2*a2x))/(2*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) + 1/2)*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - ((2*a1x - 2*a2x)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 - a2x/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)) + 1/2)/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1) + (((2*a1x - 2*a2x)/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 - a2x/2))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))*(a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2))))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)^2 - 1) + 2*(a2y - (a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))*(((((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2) - (k*(a1x - a2x)*(2*a1x - 2*a2x))/(2*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2))))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - ((2*a1x - 2*a2x)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 - a2x/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1) + (((2*a1x - 2*a2x)/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 - a2x/2))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))*(a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2))))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)^2))/(2*((a2x - (a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))^2 + (a2y - (a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))^2)^(1/2)))/L_min;
            jac(1,4) = -((2*(((((k*(a1x - a2x)*(2*a1y - 2*a2y))/(2*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) - 1/2)*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + ((2*a1y - 2*a2y)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 - a2y/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)) - 1/2)/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1) - (((2*a1y - 2*a2y)/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 - a2y/2))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))*(a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2))))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)^2)*(a1y - (a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)) + 2*(a1x - (a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))*(((((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2) - (k*(a1y - a2y)*(2*a1y - 2*a2y))/(2*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2))))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + ((2*a1y - 2*a2y)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 - a2y/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1) - (((2*a1y - 2*a2y)/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 - a2y/2))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))*(a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2))))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)^2))/(2*((a1x - (a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))^2 + (a1y - (a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))^2)^(1/2)) + (2*(a2y - (a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))*(((((k*(a1x - a2x)*(2*a1y - 2*a2y))/(2*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2)) - 1/2)*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + ((2*a1y - 2*a2y)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 - a2y/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)) - 1/2)/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1) - (((2*a1y - 2*a2y)/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 - a2y/2))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))*(a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2))))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)^2 + 1) + 2*(a2x - (a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))*(((((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2) - (k*(a1y - a2y)*(2*a1y - 2*a2y))/(2*((a1x - a2x)^2 + (a1y - a2y)^2)^(3/2))))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + ((2*a1y - 2*a2y)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 - a2y/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1) - (((2*a1y - 2*a2y)/(4*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 - a2y/2))/(4*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))*(a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2))))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)^2))/(2*((a2x - (a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))^2 + (a2y - (a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))^2)^(1/2)))/L_min;
            jac(1,5) = ((2*(((a1y - a2y)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1) + (k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2))))/(2*(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)^2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))*(a1x - (a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)) - 2*(((a1x - a2x)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + (k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1) - (k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2))))/(2*(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)^2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))*(a1y - (a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)))/(2*((a1x - (a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))^2 + (a1y - (a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))^2)^(1/2)) + (2*(((a1y - a2y)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) - (k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1) + (k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2))))/(2*(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)^2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))*(a2x - (a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)) - 2*(((a1x - a2x)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + (k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1) - (k*((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2))))/(2*(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)^2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(3/2)))*(a2y - (a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1)))/(2*((a2x - (a1x/2 + a2x/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1x/2 + a2x/2 + (k*(a1y - a2y))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))^2 + (a2y - (a1y/2 + a2y/2 + (((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)*(a1y/2 + a2y/2 - (k*(a1x - a2x))/((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)))/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)))/(((a1x - a2x)^2 + (a1y - a2y)^2)^(1/2)/(2*(k^2 + (a1x - a2x)^2/4 + (a1y - a2y)^2/4)^(1/2)) + 1))^2)^(1/2)))/L_min;
        end

    end
end